<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../../">
  <title data-ice="title">src/bin/cli.js | icon-gen</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  <script src="script/manual.js"></script>
<meta name="description" content="Generate an icon files from the SVG or PNG files"><meta property="twitter:card" content="summary"><meta property="twitter:title" content="icon-gen"><meta property="twitter:description" content="Generate an icon files from the SVG or PNG files"></head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  <a href="test.html" data-ice="testLink">Test</a>
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
<a style="position:relative; top:3px;" href="https://github.com/akabekobeko/npm-icon-gen"><img width="20px" src="./image/github.png"></a></header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-ICNSIconInfo">ICNSIconInfo</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-ICODirectory">ICODirectory</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-ICOHeader">ICOHeader</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-ImageInfo">ImageInfo</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-external">E</span><span data-ice="name"><span><a href="https://nodejs.org/api/buffer.html">Buffer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-external">E</span><span data-ice="name"><span><a href="https://nodejs.org/api/stream.html">WritableStream</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#bin">bin</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-CLI">CLI</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#lib">lib</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/lib/logger.js~Logger.html">Logger</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/lib/util.js~Util.html">Util</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-GenerateFavicon">GenerateFavicon</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-GetRequiredFavoriteImageSizes">GetRequiredFavoriteImageSizes</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-DebugUnpackIconBlocks">DebugUnpackIconBlocks</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-GenerateICNS">GenerateICNS</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-GetRequiredICNSImageSizes">GetRequiredICNSImageSizes</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-GenerateICO">GenerateICO</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-GetRequiredICOImageSizes">GetRequiredICOImageSizes</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-GenerateIcon">GenerateIcon</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-GeneratePNG">GeneratePNG</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-GetRequiredPNGImageSizes">GetRequiredPNGImageSizes</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-PackBits">PackBits</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-PackICNS">PackICNS</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-UnpackBits">UnpackBits</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">src/bin/cli.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">import Path from &apos;path&apos;
import IconGen from &apos;../lib/index.js&apos;

/**
 * Text of help.
 * @type {String}
 */
const HELP_TEXT = `
Usage: icon-gen [OPTIONS]

Generate an icon from the SVG or PNG file.
If &apos;--ico&apos;, &apos;--icns&apos;, &apos;--favicon&apos; is not specified, everything is output in the standard setting.

Options:
-h, --help    Display this text.
-v, --version Display the version number.
-i, --input   Path of the SVG file or PNG file directory.
-o, --output  Path of the output directory.
-r, --report  Display the process reports.
              Default is disable.
--ico         Output ICO file with the specified &apos;name&apos; and &apos;sizes&apos;.
              ex. --ico name=foo sizes=16,32,128
--icns        Output ICO file with the specified &apos;name&apos; and &apos;sizes&apos;.
              ex. --icns name=bar sizes=32,1024
--favicon     Output Favicon files with the specified &apos;ico&apos;, &apos;name&apos; and &apos;sizes&apos;.
              &apos;ico&apos; is the size of the ICO file.
              &apos;name&apos; is the prefix of the PNG file. Start with the alphabet, can use &apos;-&apos; and &apos;_&apos;.
              &apos;sizes&apos; is the size of the PNG file.
              ex. &apos;--favicon ico=16,32 name=favicon- sizes=16,32,128&apos;

Examples:
$ icon-gen -i sample.svg -o ./dist -r
$ icon-gen -i ./images -o ./dist -r
$ icon-gen -i sample.svg -o ./dist --ico --icns
$ icon-gen -i sample.svg -o ./dist --ico --favicon ico=16,32 name=favicon- sizes=16,32,128

See also:
https://github.com/akabekobeko/npm-icon-gen
`

/**
 * CLI parameters.
 * @type {Object}
 */
const CLI_PARAMS = {
  help: { name: &apos;--help&apos;, shortName: &apos;-h&apos; },
  version: { name: &apos;--version&apos;, shortName: &apos;-v&apos; },
  input: { name: &apos;--input&apos;, shortName: &apos;-i&apos; },
  output: { name: &apos;--output&apos;, shortName: &apos;-o&apos; },
  report: { name: &apos;--report&apos;, shortName: &apos;-r&apos; },
  ico: { name: &apos;--ico&apos; },
  icns: { name: &apos;--icns&apos; },
  favicon: { name: &apos;--favicon&apos; }
}

/**
 * Parse an option of argument.
 * @param {String} arg Option of argument. Format is &quot;value&quot; of &quot;name=value&quot;.
 * @returns {String|Object} Parsed option.
 */
const parseArgOption = (arg) =&gt; {
  const units = arg.split(&apos;=&apos;)
  if (1 &lt; units.length) {
    return { name: units[0], value: units[1] }
  } else {
    return arg
  }
}

/**
 * Parse an arguments of command line.
 * @param {String[]} argv Arguments of command line.
 * @returns {Object[]} Paesed parameters.
 */
const parseArgv = (argv) =&gt; {
  const results = []
  let param = { name: &apos;&apos;, options: [] }
  argv.forEach((arg) =&gt; {
    if (arg.startsWith(&apos;-&apos;)) {
      param = { name: arg, options: [] }
      results.push(param)
    } else {
      param.options.push(parseArgOption(arg))
    }
  })

  return results
}

/**
 * Parse the options of the image.
 * @param {Object} options Parsed options from parseArgOption function.
 * @returns {Object} Options.
 */
const parseImageOption = (options) =&gt; {
  const result = {}
  options.forEach((option) =&gt; {
    switch (option.name) {
      case &apos;name&apos;:
        result.name = option.value
        break

      case &apos;sizes&apos;:
        result.sizes = option.value.split(&apos;,&apos;).map((n) =&gt; Number(n))
        break

      // Favicon only
      case &apos;ico&apos;:
        result.ico = option.value.split(&apos;,&apos;).map((n) =&gt; Number(n))
        break

      default:
        break
    }
  })

  return result
}

const parse = (argv) =&gt; {
  if (!(argv &amp;&amp; 0 &lt; argv.length)) {
    return { help: true }
  }

  switch (argv[0]) {
    case CLI_PARAMS.help.name:
    case CLI_PARAMS.help.shortName:
      return { help: true }

    case CLI_PARAMS.version.name:
    case CLI_PARAMS.version.shortName:
      return { version: true }

    default:
      break
  }

  const options = {}
  parseArgv(argv).forEach((arg) =&gt; {
    switch (arg.name) {
      case CLI_PARAMS.input.name:
      case CLI_PARAMS.input.shortName:
        options.input = arg.options.length === 0 ? &apos;&apos; : Path.resolve(arg.options[0])
        break

      case CLI_PARAMS.output.name:
      case CLI_PARAMS.output.shortName:
        options.output = arg.options.length === 0 ? &apos;&apos; : Path.resolve(arg.options[0])
        break

      case CLI_PARAMS.report.name:
      case CLI_PARAMS.report.shortName:
        options.report = true
        break

      case CLI_PARAMS.ico.name:
        options.ico = parseImageOption(arg.options)
        break

      case CLI_PARAMS.icns.name:
        options.icns = parseImageOption(arg.options)
        break

      case CLI_PARAMS.favicon.name:
        options.favicon = parseImageOption(arg.options)
        break

      default:
        break
    }
  })

  // Generate all if all images are omitted
  if (!options.ico &amp;&amp; !options.icns &amp;&amp; !options.favicon) {
    options.ico = {}
    options.icns = {}
    options.favicon = {}
  }

  return options
}

/**
 * Show the help text.
 * @param {WritableStream} stream Target stream.
 * @return {Promise} Asynchronous task..
 */
const printHelp = (stream) =&gt; {
  return new Promise((resolve) =&gt; {
    stream.write(HELP_TEXT)
    resolve()
  })
}

/**
 * Show the version number.
 * @param {WritableStream} stream Target stream.
 * @return {Promise} Asynchronous task..
 */
const printVersion = (stream) =&gt; {
  return new Promise((resolve) =&gt; {
    const read = (path) =&gt; {
      try {
        return require(path).version
      } catch (err) {
        return null
      }
    }

    const version = read(&apos;../package.json&apos;) || read(&apos;../../package.json&apos;)
    stream.write(&apos;v&apos; + version + &apos;\n&apos;)

    resolve()
  })
}

/**
 * Entry point of the CLI.
 * @param {String[]} argv Arguments of the command line.
 * @param {WritableStream} stdout Standard output.
 * @return {Promise} Asynchronous task.
 */
const CLI = (argv, stdout) =&gt; {
  return new Promise((resolve, reject) =&gt; {
    const options = parse(argv)
    if (options.help) {
      printHelp(stdout)
      return resolve()
    }

    if (options.version) {
      printVersion(stdout)
      return resolve()
    }

    if (!options.input) {
      return reject(new Error(&apos;&quot;-i&quot; or &quot;--input&quot; has not been specified. This parameter is required.&apos;))
    }

    if (!options.output) {
      return reject(new Error(&apos;&quot;-o&quot; or &quot;--output&quot; has not been specified. This parameter is required.&apos;))
    }

    return IconGen(options.input, options.output, options)
  })
}

export default CLI
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(1.1.0)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
